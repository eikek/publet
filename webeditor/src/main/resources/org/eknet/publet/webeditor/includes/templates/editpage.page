---
title: Edit Page
searchForSidebar: false
assetGroups: publet.webeditor.editpage

--- name:content pipeline:jade
- import org.eknet.publet.vfs.Path
- val ctx = PubletWebContext
-@ val actionPath: String = ""
-@ val contentAsString: String = ""
-@ val lastMod: String = ""
-@ val resourcePath: String = ""
-@ val extensionOptions: Seq[scala.xml.Elem] = Seq()
- val viewResource = org.eknet.publet.vfs.Path(resourcePath).withExt("html").asString
.row
  .span9
    #response
    form(method="post" id="editPageForm" action={ PubletWebContext.urlOf(actionPath) })
      .form-actions
        button.btn.btn-primary
          i.icon-hdd.icon-white
          | Save
        a.btn.btn-info(href={ ctx.urlOf(viewResource) })
          i.icon-eye-open.icon-white
          | View
        a.btn.btn-danger(onClick="return confirm('Really delete this file?');" href={ ctx.urlOf(actionPath)+"?delete="+viewResource})
          i.icon-trash.icon-white
          | Delete
        a.btn.btn-info.pull-right(href={"?resource="+ (Path(resourcePath).parent.asString) })
          i.icon-file.icon-white
          | Upload Files
      label(for="extensionInput")
        | Extensions
      select.span8#extensionInput(name="extension")
        =extensionOptions
      label(for="editPage")
        | Text
      textarea#editPage.span8(name="page" style="height:380px; font-family:monospace;")<
        !~~ contentAsString
      label(for="commitMsgInput")
        | Commit Message
      input.span8#commitMsgInput(name="commitMessage" type="text")
      input(type="hidden" name="path" value={resourcePath})
      input(id="lastHead" type="hidden" name="head" value={lastMod})
  .span3
    h3 File browser
    #filesTree
:javascript
  $(document).ready(function() {
    var _mask = function(element) {
      element.mask({
        spinner: {
          lines:15,
          length: 28,
          width: 3,
          radius: 18
        },
        delay: 1000
      });
    };
    var _unmask = function(element) {
      element.unmask();
    };
    var options = {
      beforeSubmit: function(arr, form, options) {
        _mask(form);
      },
      success: function(data, status, xhr, form) {
        _unmask(form);
        var closeIcon = ' <a class="close" data-dismiss="alert" href="#">Ã—</a>';
        if (data.success) {
          $('#response').html('<div class="alert alert-success">'+data.message + closeIcon + '</div>');
          if (data.lastMod) {
            $('#lastHead').attr('value', data.lastMod);
          }
        } else {
          $('#response').html('<div class="alert alert-error">' +data.message + closeIcon + '</div>');
        }
      },
      dataType: 'json'
    };
    $('#editPageForm').ajaxForm(options);
  });